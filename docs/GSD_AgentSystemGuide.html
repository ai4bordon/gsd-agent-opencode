<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GSD (Get Shit Done) - Полное руководство по агентной системе</title>
  <style>
    :root {
      --bg: #f3f0ea;
      --paper: #fffdf9;
      --sidebar: #123454;
      --sidebar-2: #1f4a72;
      --text: #1f2933;
      --muted: #5b6876;
      --line: #dde4ec;
      --accent: #d36537;
      --code-bg: #eef2f7;
      --shadow: 0 10px 28px rgba(16, 35, 60, 0.12);
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      color: var(--text);
      font-family: "Segoe UI", "Noto Sans", "Arial", sans-serif;
      line-height: 1.62;
      background:
        radial-gradient(circle at 12% 8%, #f8e3d6 0%, transparent 32%),
        radial-gradient(circle at 90% 86%, #d9e8f8 0%, transparent 34%),
        var(--bg);
    }

    .layout { display: flex; min-height: 100vh; }

    .sidebar {
      width: 320px;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      padding: 1.2rem 1rem 1.4rem;
      background: linear-gradient(170deg, var(--sidebar) 0%, #1a446d 58%, var(--sidebar-2) 100%);
      color: #e8f1fb;
      box-shadow: var(--shadow);
      z-index: 10;
    }

    .sidebar h2 {
      margin: 0 0 0.9rem;
      font-size: 1rem;
      color: #f4f9ff;
    }

    .toc { list-style: none; margin: 0; padding: 0; }
    .toc li { margin: 0.12rem 0; }
    .toc a {
      display: block;
      text-decoration: none;
      color: #d8e8fb;
      padding: 0.34rem 0.48rem;
      border-radius: 8px;
      font-size: 0.91rem;
    }
    .toc a:hover { background: rgba(255, 255, 255, 0.12); color: #fff; }
    .l1 a { font-weight: 700; }
    .l2 a { padding-left: 1rem; font-weight: 600; }
    .l3 a { padding-left: 1.5rem; font-size: 0.87rem; color: #c6dbf2; }

    .content {
      margin-left: 320px;
      width: calc(100% - 320px);
      padding: 2.1rem 1.8rem 2.5rem;
    }

    main {
      max-width: 1040px;
      margin: 0 auto;
      padding: 2rem 2rem 2.2rem;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: var(--paper);
      box-shadow: var(--shadow);
    }

    h1, h2, h3 { color: #10253b; line-height: 1.3; scroll-margin-top: 0.8rem; }
    h1 { margin: 0 0 0.8rem; font-size: 1.95rem; border-bottom: 1px solid var(--line); padding-bottom: 0.7rem; }
    h2 { margin: 2rem 0 0.6rem; font-size: 1.4rem; border-bottom: 1px solid #e8edf4; padding-bottom: 0.35rem; }
    h3 { margin: 1.35rem 0 0.45rem; font-size: 1.06rem; }
    p { margin: 0.6rem 0; }
    ul, ol { margin: 0.45rem 0 0.85rem 1.2rem; }
    li { margin: 0.24rem 0; }

    code {
      font-family: "Cascadia Code", "Consolas", monospace;
      background: var(--code-bg);
      border: 1px solid #d8e2ef;
      border-radius: 6px;
      padding: 0.08rem 0.34rem;
      color: #16385a;
      font-size: 0.88em;
    }

    pre {
      margin: 0.8rem 0;
      padding: 0.85rem 0.95rem;
      border-radius: 10px;
      overflow: auto;
      background: #111b28;
      color: #eaf2fb;
      font-size: 0.89rem;
    }

    pre code {
      background: transparent;
      border: 0;
      color: inherit;
      padding: 0;
    }

    .table-wrap {
      margin: 0.9rem 0 1.2rem;
      overflow-x: auto;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fff;
    }

    table { border-collapse: collapse; width: 100%; min-width: 820px; }
    th, td {
      border-bottom: 1px solid #e8edf5;
      padding: 0.52rem 0.6rem;
      vertical-align: top;
      text-align: left;
      font-size: 0.9rem;
    }
    th { background: #f3f8fd; color: #123454; font-weight: 700; }
    tr:last-child td { border-bottom: 0; }

    blockquote {
      margin: 0.9rem 0;
      border-left: 4px solid var(--accent);
      background: #fff7f2;
      padding: 0.55rem 0.9rem;
      border-radius: 6px;
    }

    .menu-btn {
      display: none;
      position: fixed;
      top: 0.75rem;
      left: 0.75rem;
      z-index: 20;
      border: 0;
      border-radius: 10px;
      background: #1e4a74;
      color: #fff;
      padding: 0.5rem 0.68rem;
      box-shadow: var(--shadow);
    }

    @media (max-width: 980px) {
      .menu-btn { display: inline-block; }
      .sidebar {
        width: min(88vw, 360px);
        transform: translateX(-105%);
        transition: transform 0.2s ease;
      }
      body.menu-open .sidebar { transform: translateX(0); }
      .content {
        margin-left: 0;
        width: 100%;
        padding: 0.95rem 0.72rem 2rem;
      }
      main { padding: 1.2rem 1rem 1.5rem; }
      h1 { margin-top: 1.9rem; font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <button class="menu-btn" id="menu-btn" type="button">Меню</button>
  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <h2>Оглавление</h2>
      <ul class="toc">
        <li class="l1"><a href="#title">GSD: полное руководство</a></li>
        <li class="l2"><a href="#quick-map">1. Что это и как читать</a></li>
        <li class="l2"><a href="#architecture">2. Архитектура системы</a></li>
        <li class="l2"><a href="#commands">3. Все команды</a></li>
        <li class="l2"><a href="#agents">4. Все агенты</a></li>
        <li class="l3"><a href="#gsd-agent-role">4.1 Роль Gsd-agent</a></li>
        <li class="l2"><a href="#auto-chains">5. Автоматические цепочки</a></li>
        <li class="l3"><a href="#cycles-ralf">5.1 Встроенные циклы и RALF Lite</a></li>
        <li class="l2"><a href="#pipelines">6. Pipeline-варианты</a></li>
        <li class="l2"><a href="#user-vs-auto">7. Что запускает пользователь и что запускается само</a></li>
        <li class="l2"><a href="#artifacts">8. Артефакты и файлы состояния</a></li>
        <li class="l2"><a href="#edge-cases">9. Нюансы и edge cases</a></li>
        <li class="l2"><a href="#sources">10. Источники</a></li>
      </ul>
    </aside>
    <div class="content">
      <main>
        <h1 id="title">GSD (Get Shit Done): полное руководство по агентной системе</h1>
        <blockquote>
          Это руководство описывает полную работу GSD в OpenCode: все slash-команды, всех агентов, все ключевые pipeline-сценарии, автоматические вызовы сабагентов и артефакты в <code>.planning/</code>.
        </blockquote>

        <h2 id="quick-map">1. Что это и как читать</h2>
        <p>GSD - это command-first система агентной разработки. Главный принцип: пользователь запускает <code>/gsd-*</code>, а оркестратор внутри команды запускает специализированных агентов через <code>Task(subagent_type=...)</code> там, где это нужно.</p>
        <ul>
          <li>Если нужен быстрый старт: начни с раздела <strong>Pipeline-варианты</strong>.</li>
          <li>Если нужен полный референс: смотри таблицы <strong>Все команды</strong> и <strong>Все агенты</strong>.</li>
          <li>Если нужен "что происходит под капотом": смотри <strong>Автоматические цепочки</strong> и <strong>Артефакты</strong>.</li>
        </ul>

        <h2 id="architecture">2. Архитектура системы</h2>
        <pre><code>Пользователь
  -> /gsd-* команда (commands/gsd/*.md)
  -> оркестрация шагов + чтение/запись .planning/
  -> запуск сабагентов (agents/*.md) при необходимости
  -> обновление артефактов (PLAN/SUMMARY/VERIFICATION/UAT/STATE/ROADMAP)
  -> выдача следующей команды</code></pre>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Слой</th>
                <th>Назначение</th>
                <th>Где смотреть</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Slash-команды</td>
                <td>Точка входа, маршрутизация, запуск агентов и workflow</td>
                <td><code>commands/gsd/</code></td>
              </tr>
              <tr>
                <td>Агенты</td>
                <td>Специализированные роли (planner/executor/verifier/debugger и т.д.)</td>
                <td><code>agents/</code></td>
              </tr>
              <tr>
                <td>Workflow-правила</td>
                <td>Протоколы выполнения, верификации, дебага, resume и т.д.</td>
                <td><code>get-shit-done/workflows/</code></td>
              </tr>
              <tr>
                <td>References</td>
                <td>Checkpoints, RALF Lite, model profiles, git и config-политики</td>
                <td><code>get-shit-done/references/</code></td>
              </tr>
              <tr>
                <td>Состояние проекта</td>
                <td>Источник истины для продолжения между сессиями</td>
                <td><code>.planning/</code></td>
              </tr>
            </tbody>
          </table>
        </div>

        <h2 id="commands">3. Все команды /gsd-*</h2>
        <p>Ниже полная карта команд: что запускает пользователь, какие сабагенты вызываются автоматически, и какие файлы используются.</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Команда</th>
                <th>Аргументы</th>
                <th>Назначение</th>
                <th>Автовызовы</th>
                <th>Ключевые артефакты</th>
              </tr>
            </thead>
            <tbody>
              <tr><td><code>/gsd-help</code></td><td>-</td><td>Статический справочник команд.</td><td>Нет</td><td>Файлы не изменяет</td></tr>
              <tr><td><code>/gsd-new-project</code></td><td>-</td><td>Инициализация проекта: questioning -> optional research -> requirements -> roadmap.</td><td><code>gsd-project-researcher</code> x4, <code>gsd-research-synthesizer</code>, <code>gsd-roadmapper</code></td><td><code>.planning/PROJECT.md</code>, <code>.planning/REQUIREMENTS.md</code>, <code>.planning/ROADMAP.md</code>, <code>.planning/STATE.md</code>, <code>.planning/config.json</code>, <code>opencode.json</code></td></tr>
              <tr><td><code>/gsd-map-codebase</code></td><td>[area]</td><td>Карта существующей кодовой базы (brownfield).</td><td><code>gsd-codebase-mapper</code> x4</td><td><code>.planning/codebase/*.md</code></td></tr>
              <tr><td><code>/gsd-progress</code></td><td>-</td><td>Показывает фактический статус и выбирает следующий маршрут.</td><td>Нет</td><td>Чтение <code>.planning/STATE.md</code>, <code>.planning/ROADMAP.md</code>, summaries/uat/todos/debug</td></tr>
              <tr><td><code>/gsd-discuss-phase</code></td><td><code>&lt;N&gt;</code></td><td>Фиксирует контекст фазы до планирования.</td><td>Нет</td><td><code>.planning/phases/*/*-CONTEXT.md</code></td></tr>
              <tr><td><code>/gsd-list-phase-assumptions</code></td><td>[phase]</td><td>Показывает предположения системы до планирования.</td><td>Нет</td><td>Ничего не пишет</td></tr>
              <tr><td><code>/gsd-research-phase</code></td><td>[phase]</td><td>Отдельное фазовое исследование без обязательного планирования.</td><td><code>gsd-phase-researcher</code></td><td><code>.planning/phases/*/*-RESEARCH.md</code></td></tr>
              <tr><td><code>/gsd-plan-phase</code></td><td>[phase] [<code>--research</code>] [<code>--skip-research</code>] [<code>--gaps</code>] [<code>--skip-verify</code>]</td><td>Создает исполнимые планы фазы + цикл проверки качества планов.</td><td><code>gsd-phase-researcher</code>, <code>gsd-planner</code>, <code>gsd-plan-checker</code></td><td><code>.planning/phases/*/*-PLAN.md</code>, при необходимости <code>*-RESEARCH.md</code>, обновления roadmap</td></tr>
              <tr><td><code>/gsd-execute-phase</code></td><td><code>&lt;N&gt;</code> [<code>--gaps-only</code>]</td><td>Выполняет планы волнами (waves), потом проверяет цель фазы.</td><td><code>gsd-executor</code>, <code>gsd-verifier</code></td><td><code>*-SUMMARY.md</code>, <code>*-VERIFICATION.md</code>, обновления <code>STATE/ROADMAP/REQUIREMENTS</code></td></tr>
              <tr><td><code>/gsd-verify-work</code></td><td>[phase]</td><td>Conversational UAT + автоматическое формирование gap-планов при проблемах.</td><td>debug-диагностика, <code>gsd-planner</code> (gap-mode), <code>gsd-plan-checker</code></td><td><code>*-UAT.md</code>, gap <code>*-PLAN.md</code></td></tr>
              <tr><td><code>/gsd-quick</code></td><td>-</td><td>Короткий цикл для маленьких задач без тяжелого пайплайна.</td><td><code>gsd-planner</code>, <code>gsd-executor</code></td><td><code>.planning/quick/*/PLAN.md</code>, <code>.planning/quick/*/SUMMARY.md</code>, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-debug</code></td><td>[issue]</td><td>Системная отладка по научному методу с сохранением сессии.</td><td><code>gsd-debugger</code></td><td><code>.planning/debug/*.md</code>, архив <code>.planning/debug/resolved/</code></td></tr>
              <tr><td><code>/gsd-add-todo</code></td><td>[description]</td><td>Сохраняет идею/задачу в pending todo.</td><td>Нет</td><td><code>.planning/todos/pending/*.md</code>, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-check-todos</code></td><td>[area]</td><td>Показывает pending todos и переводит выбранные в done.</td><td>Нет</td><td><code>.planning/todos/done/*.md</code>, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-add-phase</code></td><td><code>&lt;description&gt;</code></td><td>Добавляет новую фазу в конец milestone.</td><td>Нет</td><td>Обновляет <code>ROADMAP.md</code>, директории фаз, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-insert-phase</code></td><td><code>&lt;after&gt; &lt;description&gt;</code></td><td>Вставляет срочную decimal-фазу (например 7.1).</td><td>Нет</td><td>Обновляет <code>ROADMAP.md</code>, директории фаз, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-remove-phase</code></td><td><code>&lt;phase-number&gt;</code></td><td>Удаляет будущую фазу и перенумеровывает следующие.</td><td>Нет</td><td>Изменяет <code>.planning/phases/*</code>, <code>ROADMAP.md</code>, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-audit-milestone</code></td><td>[version]</td><td>Milestone-аудит требований, интеграций и e2e-потоков.</td><td><code>gsd-integration-checker</code></td><td><code>.planning/v{version}-MILESTONE-AUDIT.md</code></td></tr>
              <tr><td><code>/gsd-plan-milestone-gaps</code></td><td>-</td><td>Преобразует gaps из аудита в новые closure-фазы.</td><td>Оркестратор gap-планирования</td><td>Обновляет <code>ROADMAP.md</code>, создает новые phase-папки</td></tr>
              <tr><td><code>/gsd-complete-milestone</code></td><td><code>&lt;version&gt;</code></td><td>Архивирует milestone и готовит следующий.</td><td>Нет</td><td><code>.planning/milestones/*</code>, обновления <code>ROADMAP/PROJECT/STATE</code></td></tr>
              <tr><td><code>/gsd-new-milestone</code></td><td>[name]</td><td>Инициализирует следующий milestone аналогично new-project.</td><td><code>gsd-project-researcher</code> x4, <code>gsd-research-synthesizer</code>, <code>gsd-roadmapper</code></td><td><code>PROJECT/REQUIREMENTS/ROADMAP/STATE</code>, <code>.planning/research/*</code></td></tr>
              <tr><td><code>/gsd-pause-work</code></td><td>-</td><td>Создает handoff для безопасной паузы.</td><td>Нет</td><td><code>.planning/phases/*/.continue-here.md</code>, <code>STATE.md</code></td></tr>
              <tr><td><code>/gsd-resume-work</code></td><td>-</td><td>Восстановление контекста через resume workflow.</td><td>Оркестрация через <code>workflows/resume-project.md</code></td><td>Продолжение через <code>STATE.md</code> и <code>.continue-here.md</code></td></tr>
              <tr><td><code>/gsd-settings</code></td><td>-</td><td>Интерактивная настройка workflow и model profiles.</td><td><code>gsd-settings</code></td><td><code>.planning/config.json</code>, <code>opencode.json</code></td></tr>
              <tr><td><code>/gsd-set-profile</code></td><td><code>&lt;quality|balanced|budget&gt;</code></td><td>Переключение активного профиля моделей.</td><td><code>gsd-set-profile</code></td><td><code>.planning/config.json</code>, <code>opencode.json</code></td></tr>
              <tr><td><code>/gsd-set-model</code></td><td>[profile]</td><td>Настройка моделей planning/execution/verification профиля.</td><td><code>gsd-set-model</code></td><td><code>.planning/config.json</code>, <code>opencode.json</code></td></tr>
              <tr><td><code>/gsd-whats-new</code></td><td>-</td><td>Показывает изменения между установленной и последней версией.</td><td>Нет</td><td>Только чтение VERSION/CHANGELOG</td></tr>
              <tr><td><code>/gsd-update</code></td><td>-</td><td>Безопасное обновление GSD с предпросмотром changelog.</td><td>Нет</td><td>Обновляет установленные файлы GSD в OpenCode конфиге</td></tr>
            </tbody>
          </table>
        </div>

        <h2 id="agents">4. Все агенты (список ролей)</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Агент</th>
                <th>Роль</th>
                <th>Кто вызывает</th>
                <th>Ключевой выход</th>
              </tr>
            </thead>
            <tbody>
              <tr><td><code>Gsd-agent</code></td><td>Primary-оркестратор всего pipeline; command router и next-command политика.</td><td>Основной агент среды</td><td>Маршрут и следующая команда</td></tr>
              <tr><td><code>gsd-codebase-mapper</code></td><td>Исследование существующего кода по фокусам tech/arch/quality/concerns.</td><td><code>/gsd-map-codebase</code></td><td><code>.planning/codebase/*.md</code></td></tr>
              <tr><td><code>gsd-project-researcher</code></td><td>Доменное исследование до roadmap.</td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code></td><td><code>.planning/research/{STACK,FEATURES,ARCHITECTURE,PITFALLS}.md</code></td></tr>
              <tr><td><code>gsd-research-synthesizer</code></td><td>Синтезирует research-выходы в единый summary и implications.</td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code></td><td><code>.planning/research/SUMMARY.md</code></td></tr>
              <tr><td><code>gsd-roadmapper</code></td><td>Трансформирует требования в roadmap с трассировкой.</td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code></td><td><code>.planning/ROADMAP.md</code>, обновления <code>STATE/REQUIREMENTS</code></td></tr>
              <tr><td><code>gsd-phase-researcher</code></td><td>Фазовое исследование перед планированием.</td><td><code>/gsd-plan-phase</code>, <code>/gsd-research-phase</code></td><td><code>*-RESEARCH.md</code></td></tr>
              <tr><td><code>gsd-planner</code></td><td>Создает PLAN.md, waves/dependencies, gap closure plans.</td><td><code>/gsd-plan-phase</code>, <code>/gsd-quick</code>, <code>/gsd-verify-work</code> (gap)</td><td><code>*-PLAN.md</code></td></tr>
              <tr><td><code>gsd-plan-checker</code></td><td>Goal-backward валидация того, что планы действительно достигнут цель.</td><td><code>/gsd-plan-phase</code>, gap-циклы</td><td>Статус <code>VERIFICATION PASSED</code> или <code>ISSUES FOUND</code></td></tr>
              <tr><td><code>gsd-executor</code></td><td>Исполнение плана с task-коммитами, deviation rules и checkpoints.</td><td><code>/gsd-execute-phase</code>, <code>/gsd-quick</code></td><td><code>*-SUMMARY.md</code>, code commits, updates <code>STATE.md</code></td></tr>
              <tr><td><code>gsd-verifier</code></td><td>Проверка фактического достижения цели фазы по коду.</td><td><code>/gsd-execute-phase</code></td><td><code>*-VERIFICATION.md</code></td></tr>
              <tr><td><code>gsd-integration-checker</code></td><td>Cross-phase wiring и e2e integrity проверка milestone.</td><td><code>/gsd-audit-milestone</code></td><td>Интеграционный отчет для milestone audit</td></tr>
              <tr><td><code>gsd-debugger</code></td><td>Научный дебаг с persistent debug session.</td><td><code>/gsd-debug</code>, diagnose flow</td><td><code>.planning/debug/*.md</code>, <code>resolved/</code></td></tr>
              <tr><td><code>gsd-settings</code></td><td>Интерактивное меню настроек профилей и toggles.</td><td><code>/gsd-settings</code></td><td>Обновления <code>.planning/config.json</code> и <code>opencode.json</code></td></tr>
              <tr><td><code>gsd-set-profile</code></td><td>Смена активного model profile.</td><td><code>/gsd-set-profile</code></td><td>Обновленные profile поля и agent models</td></tr>
              <tr><td><code>gsd-set-model</code></td><td>Настройка моделей стадий в конкретном профиле.</td><td><code>/gsd-set-model</code></td><td>Обновленные presets моделей в config</td></tr>
            </tbody>
          </table>
        </div>

        <h3 id="gsd-agent-role">4.1 Подробная роль главного оркестратора <code>Gsd-agent</code></h3>
        <p><code>Gsd-agent</code> - это центральный оркестратор системы, который управляет не отдельным ответом, а непрерывным процессом доставки: <code>idea -&gt; context -&gt; plan -&gt; execute -&gt; verify -&gt; close</code>.</p>
        <ul>
          <li><strong>Диспетчер pipeline:</strong> выбирает следующую корректную <code>/gsd-*</code> команду и держит последовательность этапов без провалов в процессе.</li>
          <li><strong>Командо-центричный режим:</strong> приоритет у явных slash-команд, а не у ad-hoc ручной оркестрации.</li>
          <li><strong>Источник истины:</strong> опирается на <code>.planning/STATE.md</code>, <code>.planning/ROADMAP.md</code>, <code>.planning/REQUIREMENTS.md</code> для маршрутизации и continuity.</li>
          <li><strong>Политика continuation:</strong> если ранее выдан <code>Next command: /gsd-...</code>, ответы пользователя типа "ok/continue/да" должны запускать именно pending-команду буквально.</li>
          <li><strong>Приоритет правил:</strong> explicit-команда пользователя выше pending-команды, pending выше общей автономии.</li>
          <li><strong>Контроль качества:</strong> не позволяет пропускать verify/gap-loop при наличии разрывов; направляет в <code>/gsd-plan-phase --gaps</code> и <code>/gsd-execute-phase --gaps-only</code>.</li>
          <li><strong>Границы автономии:</strong> самостоятельно делает безопасные обратимые шаги, но запрашивает подтверждение для необратимых/рискованных действий (prod/security/billing/secrets).</li>
          <li><strong>Ожидаемый формат шага:</strong> после каждого этапа дает кратко "что сделано", "что найдено", и конкретную следующую команду.</li>
        </ul>
        <p><strong>Мини-диаграмма принятия решения (decision tree):</strong></p>
        <pre><code>Старт шага
  |
  |-- Пользователь дал явную /gsd-* команду?
  |      |-- Да -> Выполнить именно эту команду
  |      |-- Нет
  |
  |-- Есть pending "Next command: /gsd-..." и пользователь написал "ok/continue/да"?
  |      |-- Да -> Выполнить pending-команду буквально
  |      |-- Нет
  |
  |-- .planning/ существует?
  |      |-- Нет -> /gsd-new-project (или /gsd-map-codebase -> /gsd-new-project)
  |      |-- Да
  |
  |-- Текущий статус ясен по STATE/ROADMAP?
  |      |-- Нет -> /gsd-progress
  |      |-- Да -> выбрать следующий этап pipeline:
  |                discuss -> plan -> execute -> verify -> close
  |
  '-- Если найдены gaps -> обязательный gap-loop:
         /gsd-plan-phase N --gaps -> /gsd-execute-phase N --gaps-only</code></pre>
        <p>Практический смысл: пользователь всегда понимает, где находится в процессе, что уже закрыто, и какая следующая команда должна быть выполнена без ручного "склеивания" этапов.</p>

        <h2 id="auto-chains">5. Автоматические цепочки вызовов (команда -> оркестрация -> сабагенты -> артефакты)</h2>
        <ol>
          <li><strong><code>/gsd-new-project</code>:</strong> preflight и questioning -> optional research (4 x <code>gsd-project-researcher</code>) -> <code>gsd-research-synthesizer</code> -> requirements -> <code>gsd-roadmapper</code> -> <code>PROJECT/REQUIREMENTS/ROADMAP/STATE/config</code>.</li>
          <li><strong><code>/gsd-plan-phase N</code>:</strong> выбор фазы и режима -> optional <code>gsd-phase-researcher</code> -> <code>gsd-planner</code> -> <code>gsd-plan-checker</code> -> до 3 ревизий planner/checker -> <code>*-PLAN.md</code>.</li>
          <li><strong><code>/gsd-execute-phase N</code>:</strong> чтение всех plan-файлов -> группировка по wave -> параллельные исполнители <code>gsd-executor</code> по wave -> сбор summaries -> <code>gsd-verifier</code> -> <code>*-SUMMARY.md</code> + <code>*-VERIFICATION.md</code> + обновление roadmap/state.</li>
          <li><strong><code>/gsd-verify-work N</code>:</strong> conversational UAT по deliverables -> запись <code>*-UAT.md</code> -> если проблемы: diagnose + gap planning через <code>gsd-planner</code> и <code>gsd-plan-checker</code> -> подготовка <code>/gsd-execute-phase N --gaps-only</code>.</li>
          <li><strong><code>/gsd-audit-milestone</code>:</strong> агрегация verification/summaries milestone -> запуск <code>gsd-integration-checker</code> -> итоговый <code>MILESTONE-AUDIT.md</code> -> route на completion или gap-closure.</li>
          <li><strong><code>/gsd-quick</code>:</strong> intake маленькой задачи -> <code>gsd-planner</code> (quick mode) -> <code>gsd-executor</code> -> отдельные quick-артефакты + обновление state.</li>
        </ol>

        <h3 id="cycles-ralf">5.1 Встроенные циклы и как используется RALF Lite</h3>
        <p><strong>Что в системе относится к встроенным циклам:</strong></p>
        <ul>
          <li><strong>Planner -> Checker loop (до 3 итераций):</strong> после <code>gsd-planner</code> запускается <code>gsd-plan-checker</code>; при <code>ISSUES FOUND</code> план отправляется на ревизию, максимум 3 итерации.</li>
          <li><strong>Gap-loop фазы:</strong> если есть разрывы, применяется обязательная связка <code>/gsd-plan-phase N --gaps</code> -> <code>/gsd-execute-phase N --gaps-only</code> до приемлемого результата.</li>
          <li><strong>Verify-loop после исполнения:</strong> после повторного исполнения gap-планов фаза снова проходит верификацию до статуса passed.</li>
          <li><strong>Wave-loop в execute-phase:</strong> планы идут волнами; внутри wave раунды повторяются только для упавших автономных планов.</li>
          <li><strong>Checkpoint continuation loop:</strong> при <code>checkpoint:*</code> агент останавливается, оркестратор получает решение пользователя и спавнит fresh continuation agent.</li>
          <li><strong>UAT -> diagnosis -> fix planning loop:</strong> проблемы из UAT диагностируются, затем генерируются fix/gap-планы и запускается повторное исполнение.</li>
          <li><strong>Debug investigation loop:</strong> в <code>gsd-debugger</code> используется цикл evidence -> hypothesis -> test -> evaluate.</li>
          <li><strong>Settings menu loop:</strong> в <code>gsd-settings</code> меню повторяется до явного выхода пользователя.</li>
        </ul>

        <p><strong>Как используется RALF Lite:</strong></p>
        <ul>
          <li><strong>Назначение:</strong> bounded retry-and-repair loop только для случаев, где результат можно объективно проверить.</li>
          <li><strong>Где применяется:</strong> в <code>execute-plan</code> для <code>type="auto"</code> задач и в <code>execute-phase</code> для <code>autonomous: true</code> планов.</li>
          <li><strong>Где не применяется:</strong> не обходит <code>checkpoint:*</code> и не подменяет архитектурные решения, требующие человеческого выбора.</li>
          <li><strong>Условия остановки:</strong> success, достижение <code>max_iterations</code>, повторяющийся error fingerprint, отсутствие прогресса.</li>
          <li><strong>Отчетность:</strong> итоговые summaries должны содержать блок <code>RALF Lite Loop Report</code> с фактическими попытками и причиной остановки.</li>
          <li><strong>Как отключить глобально:</strong> изменить <code>${OPENCODE_CONFIG_DIR:-~/.config/opencode}/get-shit-done/config.json</code> и поставить <code>ralf_lite.enabled: false</code> (или выключить точечно <code>apply_to.auto_tasks/autonomous_plans</code>).</li>
          <li><strong>Как переопределить в проекте:</strong> добавить секцию <code>ralf_lite</code> в <code>.planning/config.json</code> и задать нужные поля (<code>enabled</code>, <code>max_iterations</code>, <code>error_fingerprint_repeats</code>, <code>no_progress_repeats</code>, <code>apply_to.*</code>).</li>
          <li><strong>Важно про настройки:</strong> меню <code>/gsd-settings</code> не редактирует RALF Lite defaults; это делается через global config или project override вручную.</li>
        </ul>

        <h2 id="pipelines">6. Полный pipeline разработки в вариантах</h2>
        <h3>6.1 Greenfield (новый проект)</h3>
        <pre><code>/gsd-new-project
/gsd-discuss-phase 1
/gsd-plan-phase 1
/gsd-execute-phase 1
/gsd-verify-work 1
# если есть gaps
/gsd-plan-phase 1 --gaps
/gsd-execute-phase 1 --gaps-only
# дальше следующая фаза или audit milestone</code></pre>

        <h3>6.2 Brownfield (существующий код)</h3>
        <pre><code>/gsd-map-codebase
/gsd-new-project
/gsd-progress
/gsd-discuss-phase 1
/gsd-plan-phase 1</code></pre>

        <h3>6.3 Фазовый цикл от контекста до приемки</h3>
        <pre><code>/gsd-discuss-phase N
/gsd-research-phase N     # опционально
/gsd-plan-phase N
/gsd-execute-phase N
/gsd-verify-work N</code></pre>

        <h3>6.4 Gap-closure цикл (когда цель не достигнута)</h3>
        <pre><code>/gsd-plan-phase N --gaps
/gsd-execute-phase N --gaps-only
/gsd-verify-work N         # или /gsd-audit-milestone на конце milestone</code></pre>

        <h3>6.5 Milestone close цикл</h3>
        <pre><code>/gsd-audit-milestone [version]
/gsd-plan-milestone-gaps   # если audit нашел разрывы
/gsd-complete-milestone X.Y.Z
/gsd-new-milestone "Next scope"</code></pre>

        <h3>6.6 Incident/debug цикл</h3>
        <pre><code>/gsd-debug "симптом проблемы"
# при необходимости после /new
/gsd-debug
# затем fix через quick или phase pipeline</code></pre>

        <h2 id="user-vs-auto">7. Что вызывает пользователь, а что вызывается автоматически</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Тип</th>
                <th>Что именно</th>
                <th>Кто инициирует</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Явные команды</td><td><code>/gsd-*</code> (new-project, plan-phase, execute-phase, verify-work и т.д.)</td><td>Пользователь</td></tr>
              <tr><td>Сабагенты для планирования</td><td><code>gsd-phase-researcher</code>, <code>gsd-planner</code>, <code>gsd-plan-checker</code></td><td>Команда-оркестратор (<code>/gsd-plan-phase</code>)</td></tr>
              <tr><td>Сабагенты для выполнения</td><td><code>gsd-executor</code>, <code>gsd-verifier</code></td><td><code>/gsd-execute-phase</code></td></tr>
              <tr><td>Сабагенты инициализации</td><td><code>gsd-project-researcher</code> x4, <code>gsd-research-synthesizer</code>, <code>gsd-roadmapper</code></td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code></td></tr>
              <tr><td>Сабагенты аудита</td><td><code>gsd-integration-checker</code></td><td><code>/gsd-audit-milestone</code></td></tr>
              <tr><td>Сабагент отладки</td><td><code>gsd-debugger</code></td><td><code>/gsd-debug</code> (и diagnose-path в verify)</td></tr>
              <tr><td>Настройки моделей</td><td><code>gsd-settings</code>, <code>gsd-set-profile</code>, <code>gsd-set-model</code></td><td>Команды <code>/gsd-settings</code>, <code>/gsd-set-profile</code>, <code>/gsd-set-model</code></td></tr>
            </tbody>
          </table>
        </div>

        <h2 id="artifacts">8. Ключевые артефакты и кто их создает</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Артефакт</th>
                <th>Кто создает/обновляет</th>
                <th>Роль в pipeline</th>
              </tr>
            </thead>
            <tbody>
              <tr><td><code>.planning/PROJECT.md</code></td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code></td><td>Видение и границы проекта/милестоуна</td></tr>
              <tr><td><code>.planning/REQUIREMENTS.md</code></td><td><code>/gsd-new-project</code>, <code>/gsd-new-milestone</code>, <code>/gsd-execute-phase</code> (обновления)</td><td>Требования и трассировка к фазам</td></tr>
              <tr><td><code>.planning/ROADMAP.md</code></td><td><code>gsd-roadmapper</code>, roadmap-команды, execute/complete flows</td><td>План фаз и состояние milestone</td></tr>
              <tr><td><code>.planning/STATE.md</code></td><td>Почти все оркестраторы, особенно execute/pause/progress</td><td>Память проекта и continuity между сессиями</td></tr>
              <tr><td><code>.planning/config.json</code></td><td><code>/gsd-new-project</code>, <code>/gsd-settings</code>, <code>/gsd-set-profile</code>, <code>/gsd-set-model</code></td><td>Workflow toggles, profiles, RALF overrides</td></tr>
              <tr><td><code>.planning/codebase/*.md</code></td><td><code>/gsd-map-codebase</code> + <code>gsd-codebase-mapper</code></td><td>Карта существующего кода</td></tr>
              <tr><td><code>.planning/research/*.md</code></td><td><code>gsd-project-researcher</code>, <code>gsd-research-synthesizer</code></td><td>Исследовательская база перед roadmap</td></tr>
              <tr><td><code>.planning/phases/*/*-CONTEXT.md</code></td><td><code>/gsd-discuss-phase</code></td><td>Зафиксированные решения фазы</td></tr>
              <tr><td><code>.planning/phases/*/*-RESEARCH.md</code></td><td><code>gsd-phase-researcher</code></td><td>Технические варианты и риски фазы</td></tr>
              <tr><td><code>.planning/phases/*/*-PLAN.md</code></td><td><code>gsd-planner</code></td><td>Исполнимые планы (включая waves/depends)</td></tr>
              <tr><td><code>.planning/phases/*/*-SUMMARY.md</code></td><td><code>gsd-executor</code></td><td>Факт выполнения задач и отклонений</td></tr>
              <tr><td><code>.planning/phases/*/*-VERIFICATION.md</code></td><td><code>gsd-verifier</code></td><td>Goal-backward проверка достижения цели</td></tr>
              <tr><td><code>.planning/phases/*/*-UAT.md</code></td><td><code>/gsd-verify-work</code></td><td>Результат conversational приемки</td></tr>
              <tr><td><code>.planning/v*-MILESTONE-AUDIT.md</code></td><td><code>/gsd-audit-milestone</code> + <code>gsd-integration-checker</code></td><td>Решение: закрывать milestone или делать gap-фазы</td></tr>
              <tr><td><code>.planning/quick/*</code></td><td><code>/gsd-quick</code></td><td>Отдельный трек быстрых задач</td></tr>
              <tr><td><code>.planning/debug/*</code></td><td><code>/gsd-debug</code> + <code>gsd-debugger</code></td><td>Persistent debug sessions и архив resolved</td></tr>
              <tr><td><code>.planning/todos/pending|done</code></td><td><code>/gsd-add-todo</code>, <code>/gsd-check-todos</code></td><td>Backlog идей и задач</td></tr>
            </tbody>
          </table>
        </div>

        <h2 id="edge-cases">9. Нюансы, правила и edge cases</h2>
        <h3>9.1 Критические протоколы качества</h3>
        <ul>
          <li><strong>Plan quality loop:</strong> после <code>gsd-planner</code> запускается <code>gsd-plan-checker</code>; при проблемах - до 3 итераций ревизии.</li>
          <li><strong>Goal-backward verify:</strong> <code>gsd-verifier</code> проверяет не "отчет", а фактическую доставку в коде.</li>
          <li><strong>RALF Lite:</strong> ограниченные auto-retry циклы (обычно до 3) с остановкой при повторяющемся fingerprint или отсутствии прогресса.</li>
          <li><strong>Checkpoints:</strong> <code>human-verify</code>, <code>decision</code>, <code>human-action</code> из <code>references/checkpoints.md</code>.</li>
          <li><strong>Gap loop обязателен:</strong> gaps из verify/UAT/audit не игнорируются, а закрываются через <code>--gaps</code> и/или milestone gap-фазы.</li>
        </ul>

        <h3>9.2 Что важно про Git и planning-документы</h3>
        <ul>
          <li>Поведение управляется <code>planning.commit_docs</code> и <code>planning.search_gitignored</code> (см. <code>references/planning-config.md</code>).</li>
          <li>При <code>commit_docs=false</code> planning-артефакты могут быть локальными и исключены из git через <code>.gitignore</code>.</li>
          <li>Executor-коммиты атомарные; запрещен грубый стейджинг типа <code>git add .</code> внутри task-коммитов.</li>
        </ul>

        <h3>9.3 Обнаруженные расхождения между файлами</h3>
        <ul>
          <li><strong>Путь milestone audit:</strong> в <code>commands/gsd/audit-milestone.md</code> встречается шаблон <code>.planning/v{version}-v{version}-MILESTONE-AUDIT.md</code>, но в остальных местах используется <code>.planning/v{version}-MILESTONE-AUDIT.md</code> (в т.ч. <code>commands/gsd/plan-milestone-gaps.md</code>, <code>commands/gsd/complete-milestone.md</code>).</li>
          <li><strong>Trigger docs vs фактические вызовы:</strong> <code>agents/gsd-roadmapper.md</code> и <code>agents/gsd-research-synthesizer.md</code> описывают запуск только из <code>/gsd-new-project</code>, но реально вызываются и в <code>commands/gsd/new-milestone.md</code>.</li>
          <li><strong>Маршрут completion:</strong> <code>commands/gsd/progress.md</code> может рекомендовать <code>/gsd-complete-milestone</code> без версии, хотя <code>commands/gsd/complete-milestone.md</code> требует обязательный <code>&lt;version&gt;</code>.</li>
          <li><strong>Количество агентов в mapping:</strong> в <code>agents/gsd-set-profile.md</code> и <code>agents/gsd-set-model.md</code> подписано "11 agents", но по списку в таблицах выходит больше.</li>
        </ul>

        <h2 id="sources">10. Источники (где проверять факты)</h2>
        <ul>
          <li><code>commands/gsd/help.md</code></li>
          <li><code>commands/gsd/new-project.md</code></li>
          <li><code>commands/gsd/new-milestone.md</code></li>
          <li><code>commands/gsd/plan-phase.md</code></li>
          <li><code>commands/gsd/execute-phase.md</code></li>
          <li><code>commands/gsd/verify-work.md</code></li>
          <li><code>commands/gsd/audit-milestone.md</code></li>
          <li><code>commands/gsd/plan-milestone-gaps.md</code></li>
          <li><code>commands/gsd/complete-milestone.md</code></li>
          <li><code>commands/gsd/debug.md</code></li>
          <li><code>agents/Gsd-agent.md</code></li>
          <li><code>agents/gsd-planner.md</code></li>
          <li><code>agents/gsd-executor.md</code></li>
          <li><code>agents/gsd-verifier.md</code></li>
          <li><code>agents/gsd-plan-checker.md</code></li>
          <li><code>agents/gsd-phase-researcher.md</code></li>
          <li><code>agents/gsd-project-researcher.md</code></li>
          <li><code>agents/gsd-research-synthesizer.md</code></li>
          <li><code>agents/gsd-roadmapper.md</code></li>
          <li><code>agents/gsd-debugger.md</code></li>
          <li><code>agents/gsd-codebase-mapper.md</code></li>
          <li><code>agents/gsd-integration-checker.md</code></li>
          <li><code>agents/gsd-settings.md</code></li>
          <li><code>agents/gsd-set-profile.md</code></li>
          <li><code>agents/gsd-set-model.md</code></li>
          <li><code>get-shit-done/workflows/execute-phase.md</code></li>
          <li><code>get-shit-done/workflows/execute-plan.md</code></li>
          <li><code>get-shit-done/workflows/verify-work.md</code></li>
          <li><code>get-shit-done/workflows/verify-phase.md</code></li>
          <li><code>get-shit-done/workflows/complete-milestone.md</code></li>
          <li><code>get-shit-done/workflows/diagnose-issues.md</code></li>
          <li><code>get-shit-done/workflows/resume-project.md</code></li>
          <li><code>get-shit-done/references/checkpoints.md</code></li>
          <li><code>get-shit-done/references/ralf-lite.md</code></li>
          <li><code>get-shit-done/references/planning-config.md</code></li>
          <li><code>get-shit-done/references/model-profiles.md</code></li>
          <li><code>get-shit-done/references/git-integration.md</code></li>
        </ul>
      </main>
    </div>
  </div>

  <script>
    (function () {
      var btn = document.getElementById("menu-btn");
      if (!btn) return;
      btn.addEventListener("click", function () {
        document.body.classList.toggle("menu-open");
      });
      document.addEventListener("click", function (e) {
        if (window.innerWidth > 980) return;
        var sidebar = document.getElementById("sidebar");
        if (!sidebar) return;
        if (sidebar.contains(e.target) || btn.contains(e.target)) return;
        document.body.classList.remove("menu-open");
      });
    })();
  </script>
</body>
</html>
